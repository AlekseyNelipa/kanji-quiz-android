name: Validate Android signing secrets

on:
  workflow_dispatch:

jobs:
  validate:
    runs-on: ubuntu-latest
    steps:
      - name: Decode keystore and validate password
        env:
          KEYSTORE_BASE64: ${{ secrets.KEYSTORE_BASE64 }}
          KEYSTORE_PASSWORD: ${{ secrets.KEYSTORE_PASSWORD }}
          KEY_ALIAS: ${{ secrets.KEY_ALIAS }}
          KEY_PASSWORD: ${{ secrets.KEY_PASSWORD }}
        run: |
          echo "$KEYSTORE_BASE64" | base64 --decode > release.p12

          mkdir dummy
          echo x > dummy/x.txt
          (cd dummy && jar cf ../dummy.jar x.txt)

          jarsigner \
            -keystore release.p12 -storetype PKCS12 \
            -storepass "$KEYSTORE_PASSWORD" \
            -keypass "$KEY_PASSWORD" \
            dummy.jar "$KEY_ALIAS" >/dev/null

          echo "OK"
